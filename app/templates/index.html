<html>
  <head>
    <title>LangEvolve</title>

    <!-- Bootstrap and JQuery files -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script>
    // Trigger the evolve function when link is clicked
    $(function() {
      $("#evolvetrigger").click(function(e) {evolve()});      
    });
    
    // Request the evolved language from Flask and display it
    function evolve() {
      var args = {words: $('textarea[name="word_list"]').val(),
                  generations: $('input[name="generations"]').val()}

      $.post('/evolve', args).done(function(evolved) {
        if (evolved['error'] != 0) {
          show_alert_box(evolved['error']);
        } else {
          $('#alert_area').hide();
          document.getElementById('rules').innerHTML = "";
          document.getElementById('words').innerHTML = "";
          document.getElementById('rules').appendChild(join_array(evolved['rules'], 'Sound change rules'));
          document.getElementById('words').appendChild(join_array(evolved['words'], 'Evolved words'));
        }
                         }).fail(function() {
                              $(words).text("Error occurred")});
                         };
    function show_alert_box(alert_text) {
      $('#alert_message').text(alert_text);
      $('#alert_area').show();
    }

    // Joins an array of text into a list group within a titled panel 
    function join_array(a, title) {
      var list = document.createElement('ul');
      list.className = "list-group";

      for (var i = 0; i < a.length; i++) {
        var item = document.createElement('li');
        item.className = "list-group-item";
        item.appendChild(document.createTextNode(a[i]));
        list.appendChild(item);
      }
      
      return build_panel(list, title)
    };
    
    // Creates a panel with given title and contents
    function build_panel(contents, title) {
      var panel = document.createElement('div');
      panel.className = "panel panel-default";
      var titleDiv = document.createElement('div');
      titleDiv.className = "panel-heading";
      var heading = document.createElement('h3');
      heading.className = "panel-title";
      heading.appendChild(document.createTextNode(title));
      
      var body = document.createElement('div');
      body.className = "panel-body";
      body.appendChild(contents);
      
      titleDiv.appendChild(heading);
      panel.appendChild(titleDiv);
      panel.appendChild(body);
      return panel
    };
    
    // When the window is loaded, save the automatic panel heights.
    window.onload = function set_panels(){
      save_info();
      resize_panels();
    };
    
    window.onresize = resize_panels;
    
    function save_info(){
        window.word_height = $('#word_panel').height();
        window.settings_height = $('#settings_panel').height();
    };
    
    // If the panels are side-by-side, resize them to all be the height
    // of the words panel. Otherwise, set them back to the automatic heights.
    function resize_panels(){
        if ( $(window).width() > 768) {
          $('#settings_panel').height(window.word_height);  
        } else {
          $('#word_panel').height(window.word_height);
          $('#settings_panel').height(window.settings_height);
        }
        
    };
    </script>

  </head>
  <body>
    <div class="container">
      <!-- Area for alerts -->
      <div id="alert_area" class="alert alert-warning alert-dismissable" role="alert" style="display: none">
        <button type="button" class="close" onclick="$('#alert_area').hide();">&times;</button>
        <p id="alert_message">Error</p>
      </div>

      <div class="row">
        
        <!-- The information panel -->
        <div class="col-md-4">
              <h1>LangEvolve</h1>

              <p>LangEvolve is a (mostly) linguistically-accurate language evolution simulator. Enter a list of words to evolve to the right, tweak the settings, and hit <emph>Evolve!</emph> to see it in action.</p>

              <div><a id="evolvetrigger" href="#" class="btn btn-primary center-block">Evolve!</a></div>
              <br> 
        </div>
        
        <!-- The word list panel -->
        <div class="col-md-4">
          <div class="panel panel-default" id="word_panel">
            <div class="panel-heading">
              <h3 class="panel-title">Words</h3>
            </div>
            <div class="panel-body">
              <textarea id="word_list" name="word_list" style="width: 100% !important" rows=20 >Enter words</textarea>
            </div>
          </div>
        </div>
        
        <!-- The settings panel -->
        <div class="col-md-4">
          <div class="panel panel-default" id="settings_panel">
            <div class="panel-heading">
              <h3 class="panel-title">Settings</h3>
            </div>
            <div class="panel-body">
              <form>
                <div class="form-group">
                  <label for="generations">Generations</label>
                  <input type="number" class="form-control" id = "generations" name="generations" value="5">
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <hr>
      
      <div class="row">
        <div class="col-md-6">
          <div id="rules"></div>
        </div>
        <div class="col-md-6">
          <div id="words"></div>
        </div>
    </div>
  </body>
</html>
